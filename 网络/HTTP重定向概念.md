### HTTP重定向概念

> URL重定向,也称为URL转发,是一种 当实际资源(如单个页面, 表单或者整个web应用) 被迁移到新的URL下的时候, 保持(原有)链接可用的技术.

### 重定向可以实现许多目标

1. 站点维护或者停机期间的临时重定向.
2. 永久重定向 将会更改站点的URL,

### HTTP重定向的原理

> 在HTTP协议中, 重定向操作由**服务器**通过发送特殊的响应(redirects)触发. 重定向响应的状态码为3xx.
>
> 浏览器在接到重定向 响应的时候 会采用该响应提供的新的URL, 并立即进行加载; 重定向操作对于用户来说是不可见的. 但是会造成一小部分的性能损失.

### HTTP重定向的分类

1. 永久重定向

   1. 表示原来的URL,不在使用, 而应该选用新的URL的永久性操作. 

   2. 搜索引擎机器人会在遇到该状态码时 触发更新操作,在其索引库中修改与该资源相关的URL.

      | 状态码 | 含义               | 是否更改原请求方法                                | 应用场景                    |
      | :----- | ------------------ | ------------------------------------------------- | --------------------------- |
      | 301    | Moved Permanently  | GET方法不会被修改;<br /> 其他方法可能被修改为GET. | 网站重建                    |
      | 308    | Permanent Redirect | 方法和消息主体都不发生变化.                       | 方法和消息主体都不发生变化. |

      308 状态码被创建用来消除在使用非 GET 方法时的歧义行为。

2. 临时重定向

   1. 有时候请求的资源无法从其标准地址访问，但是却可以从另外的地方访问.

   2. 搜索引擎不会记录该新的、临时的链接. 在创建、更新或者删除资源的时候，临时重定向也可以用于显示临时性的进度页面.

      | 状态码 | 含义               | 是否更改原请求方法                                | 应用场景                                                     |
      | :----- | ------------------ | ------------------------------------------------- | ------------------------------------------------------------ |
      | 302    | Found              | GET方法不会被修改;<br /> 其他方法可能被修改为GET. | 由于不可预见的原因该页面暂不可用.                            |
      | 303    | See Other          | GET方法不会被修改;<br /> 其他方法**会变更为**GET. | 用于[`PUT`](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/PUT) 或 [`POST`](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/POST) 请求完成之后进行页面跳转来<br />防止由于页面刷新导致的操作的重复触发。 |
      | 307    | Temporary Redirect | 方法和消息主体都不发生变化                        | 由于不可预见的原因该页面暂时不可用<br />当站点支持非 GET 方法的链接或操作的时候，该状态码优于 302 状态码。 |

      307 状态码被创建用来消除在使用非 GET 方法时的歧义行为。

3. 特殊重定向

   | 状态码 | 含义            | 应用场景                                                     |
   | ------ | --------------- | ------------------------------------------------------------ |
   | 300    | Multiple Choice | 不常用：所有的选项在消息主体的 HTML 页面中列出。鼓励在 [`Link`](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Link) 头部加入机器可读的 `rel=alternate` |
   | 304    | Not Modified    | 发送用于重新验证的条件请求 .表示缓存的响应仍然是新鲜的并且可以使用 |

### 重定向的其他设置方法

1. 借助 HTML 的 meta 元素的 HTML 重定向机制

   ```js
   <head>
     <meta http-equiv="Refresh" content="0; URL=http://example.com/" />
   </head>
   ```

   [`content`](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Global_attributes#attr-content) 属性的值开头是一个数字，指示浏览器在等待该数字表示的秒数之后再进行跳转。建议始终将其设置为 0 来获取更好的无障碍。

   使用范围: 仅适用于 HTML 页面（或类似的页面），然而并不能应用于图片或者其他类型的内容.

2. 借助 [DOM](https://developer.mozilla.org/zh-CN/docs/Web/API/Document_Object_Model) 的 JavaScript 重定向机制。

   ```js
   window.location = "http://example.com/";
   ```

   使用范围: 在支持 JavaScript 的客户端上才能使用

### 3种设置重定向方法的优先级

1. HTTP 协议的重定向机制永远最先触发，即便是在没有传送任何页面——也就没有页面被（客户端）读取——的情况下。
2. HTML 的重定向机制 ([``](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/meta)) 会在 HTTP 协议重定向机制未设置的情况下触发。
3. JavaScript 的重定向机制总是作为最后兜底的手段，并且只有在客户端开启了 JavaScript 的情况下才起作用。

总结: **HTTP 协议的重定向机制优先**.假如开发人员修改了 HTTP 重定向映射,而忘记修改 HTML 页面的重定向映射，那么二者就会不一致，最终结果或者出现无限循环，或者导致其他噩梦的发生。

### 重定向的性能开销

> HTTP重定向需要额外的DNS查询, TCP握手等比较耗时.